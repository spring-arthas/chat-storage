# ç™»å½•æ³¨å†ŒåŠŸèƒ½è¿è¡Œé€»è¾‘åˆ†æ

> **æ–‡æ¡£ç›®çš„**: æ·±å…¥åˆ†æç™»å½•æ³¨å†ŒåŠŸèƒ½çš„è¿è¡Œæµç¨‹ã€çŠ¶æ€ç®¡ç†å’Œæ•°æ®æµå‘  
> **é€‚åˆè¯»è€…**: éœ€è¦ç†è§£ SwiftUI å“åº”å¼ç¼–ç¨‹å’ŒçŠ¶æ€ç®¡ç†çš„å¼€å‘è€…

---

## ğŸš€ åº”ç”¨å¯åŠ¨æµç¨‹

### 1. åº”ç”¨å…¥å£ (`chat_storageApp.swift`)

```swift
@main
struct chat_storageApp: App {
    let persistenceController = PersistenceController.shared  // â‘  åˆ›å»ºæ•°æ®åº“æ§åˆ¶å™¨
    
    var body: some Scene {
        WindowGroup {
            LoginView()  // â‘¡ æ˜¾ç¤ºç™»å½•ç•Œé¢ä½œä¸ºå¯åŠ¨é¡µ
                .environment(\.managedObjectContext, 
                           persistenceController.container.viewContext)  // â‘¢ æ³¨å…¥æ•°æ®åº“ä¸Šä¸‹æ–‡
        }
    }
}
```

**æ‰§è¡Œé¡ºåº**:
1. **åº”ç”¨å¯åŠ¨** â†’ macOS è°ƒç”¨æ ‡è®°äº† `@main` çš„ç»“æ„ä½“
2. **åˆå§‹åŒ–æ•°æ®åº“** â†’ åˆ›å»º `PersistenceController.shared` å•ä¾‹
3. **åˆ›å»ºçª—å£ç»„** â†’ `WindowGroup` åˆ›å»ºä¸»çª—å£
4. **æ¸²æŸ“è§†å›¾** â†’ SwiftUI æ¸²æŸ“ `LoginView()`
5. **æ³¨å…¥ç¯å¢ƒ** â†’ Core Data ä¸Šä¸‹æ–‡æ³¨å…¥åˆ°è§†å›¾æ ‘

---

## ğŸ” ç™»å½•ç•Œé¢è¿è¡Œé€»è¾‘

### ç•Œé¢åˆå§‹åŒ–

```swift
struct LoginView: View {
    // â‘  çŠ¶æ€å˜é‡åˆå§‹åŒ–ï¼ˆè§†å›¾åˆ›å»ºæ—¶ï¼‰
    @State private var username: String = ""
    @State private var password: String = ""
    @State private var errorMessage: String = ""
    @State private var showRegister: Bool = false
    @State private var isLoading: Bool = false
    
    var body: some View {
        // â‘¡ æ ¹æ® showRegister çŠ¶æ€å†³å®šæ˜¾ç¤ºå“ªä¸ªç•Œé¢
        if showRegister {
            RegisterView(showRegister: $showRegister)  // æ˜¾ç¤ºæ³¨å†Œç•Œé¢
        } else {
            loginContent  // æ˜¾ç¤ºç™»å½•ç•Œé¢å†…å®¹
        }
    }
}
```

**å…³é”®ç‚¹**:
- **`@State` ä¿®é¥°ç¬¦**: å½“è¿™äº›å˜é‡çš„å€¼æ”¹å˜æ—¶ï¼ŒSwiftUI ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“ä½¿ç”¨äº†è¿™äº›å˜é‡çš„è§†å›¾éƒ¨åˆ†
- **æ¡ä»¶æ¸²æŸ“**: `if showRegister` å®ç°äº†ä¸¤ä¸ªç•Œé¢çš„åˆ‡æ¢

---

### ç”¨æˆ·äº¤äº’æµç¨‹å›¾

```mermaid
graph TD
    A[ç”¨æˆ·çœ‹åˆ°ç™»å½•ç•Œé¢] --> B{ç”¨æˆ·æ“ä½œ}
    B -->|è¾“å…¥ç”¨æˆ·å| C[æ›´æ–° username å˜é‡]
    C --> D[è§¦å‘ onChange]
    D --> E[æ¸…é™¤é”™è¯¯ä¿¡æ¯]
    
    B -->|è¾“å…¥å¯†ç | F[æ›´æ–° password å˜é‡]
    F --> G[è§¦å‘ onChange]
    G --> E
    
    B -->|ç‚¹å‡»ç™»å½•æŒ‰é’®| H[è°ƒç”¨ handleLogin]
    H --> I{éªŒè¯ç”¨æˆ·å}
    I -->|æ— æ•ˆ| J[è®¾ç½® errorMessage]
    J --> K[UI è‡ªåŠ¨æ˜¾ç¤ºé”™è¯¯]
    
    I -->|æœ‰æ•ˆ| L{éªŒè¯å¯†ç }
    L -->|æ— æ•ˆ| J
    L -->|æœ‰æ•ˆ| M[è®¾ç½® isLoading = true]
    M --> N[UI æ˜¾ç¤ºåŠ è½½åŠ¨ç”»]
    N --> O[è°ƒç”¨ performLogin ä¼ªä»£ç ]
    O --> P{ç™»å½•ç»“æœ}
    P -->|æˆåŠŸ| Q[æ§åˆ¶å°è¾“å‡ºæˆåŠŸä¿¡æ¯]
    P -->|å¤±è´¥| R[è®¾ç½®é”™è¯¯ä¿¡æ¯]
    R --> S[è®¾ç½® isLoading = false]
    S --> K
    
    B -->|ç‚¹å‡»æ³¨å†ŒæŒ‰é’®| T[è®¾ç½® showRegister = true]
    T --> U[UI è‡ªåŠ¨åˆ‡æ¢åˆ°æ³¨å†Œç•Œé¢]
```

---

### ç™»å½•æŒ‰é’®ç‚¹å‡»è¯¦ç»†æµç¨‹

#### æ­¥éª¤ 1: ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®

```swift
Button(action: handleLogin) {
    // æŒ‰é’®å¤–è§‚
}
```

#### æ­¥éª¤ 2: æ‰§è¡Œ `handleLogin()` æ–¹æ³•

```swift
private func handleLogin() {
    // â‘  æ¸…é™¤ä¹‹å‰çš„é”™è¯¯ä¿¡æ¯
    errorMessage = ""  // è§¦å‘ UI æ›´æ–°ï¼Œéšè—é”™è¯¯æç¤º
    
    // â‘¡ éªŒè¯ç”¨æˆ·åæ ¼å¼
    guard InputValidator.isValidUsername(username) else {
        errorMessage = InputValidator.getUsernameErrorMessage(username)
        // errorMessage å˜åŒ– â†’ SwiftUI é‡æ–°æ¸²æŸ“ â†’ æ˜¾ç¤ºé”™è¯¯æ–‡æœ¬
        return  // ä¸­æ–­æ‰§è¡Œ
    }
    
    // â‘¢ éªŒè¯å¯†ç 
    guard InputValidator.isValidPassword(password) else {
        errorMessage = InputValidator.getPasswordErrorMessage(password)
        return
    }
    
    // â‘£ æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    isLoading = true  // è§¦å‘ UI æ›´æ–°ï¼ŒæŒ‰é’®æ˜¾ç¤º ProgressView
    
    // â‘¤ æ¨¡æ‹Ÿå¼‚æ­¥ç½‘ç»œè¯·æ±‚
    DispatchQueue.main.asyncAfter(deadline: .now() + 1.5) {
        let success = performLogin(username: username, password: password)
        
        isLoading = false  // è§¦å‘ UI æ›´æ–°ï¼Œéšè—åŠ è½½åŠ¨ç”»
        
        if success {
            print("âœ… ç™»å½•æˆåŠŸï¼")
            // TODO: å®é™…é¡¹ç›®ä¸­åº”è¯¥å¯¼èˆªåˆ°ä¸»ç•Œé¢
        } else {
            errorMessage = "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"  // è§¦å‘ UI æ›´æ–°
        }
    }
}
```

---

### è¾“å…¥éªŒè¯é€»è¾‘ (`InputValidator`)

#### éªŒè¯æµç¨‹

```mermaid
graph LR
    A[ç”¨æˆ·è¾“å…¥] --> B{InputValidator.isValidUsername}
    B --> C{åŒ…å« @}
    C -->|æ˜¯| D[isValidEmail]
    D --> E{æ­£åˆ™åŒ¹é…}
    E -->|é€šè¿‡| F[âœ… æœ‰æ•ˆé‚®ç®±]
    E -->|å¤±è´¥| G[âŒ é‚®ç®±æ ¼å¼é”™è¯¯]
    
    C -->|å¦| H[isValidPhone]
    H --> I{æ­£åˆ™: ^1[3-9]\\d9$}
    I -->|é€šè¿‡| J[âœ… æœ‰æ•ˆæ‰‹æœºå·]
    I -->|å¤±è´¥| K[âŒ æ‰‹æœºå·æ ¼å¼é”™è¯¯]
```

#### æ ¸å¿ƒéªŒè¯ä»£ç 

```swift
// æ‰‹æœºå·éªŒè¯
static func isValidPhone(_ phone: String) -> Bool {
    let phonePattern = "^1[3-9]\\d{9}$"
    // â‘  åˆ›å»ºè°“è¯å¯¹è±¡
    let phonePredicate = NSPredicate(format: "SELF MATCHES %@", phonePattern)
    // â‘¡ ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
    return phonePredicate.evaluate(with: phone)
}

// ç”¨æˆ·åéªŒè¯ï¼ˆæ‰‹æœºå·æˆ–é‚®ç®±ï¼‰
static func isValidUsername(_ username: String) -> Bool {
    return isValidPhone(username) || isValidEmail(username)
    // åªè¦æ»¡è¶³å…¶ä¸­ä¸€ä¸ªæ¡ä»¶å³å¯
}
```

---

## ğŸ“ æ³¨å†Œç•Œé¢è¿è¡Œé€»è¾‘

### çˆ¶å­è§†å›¾é€šä¿¡æœºåˆ¶

```swift
// çˆ¶è§†å›¾ LoginView
@State private var showRegister: Bool = false

// ä¼ é€’ç»™å­è§†å›¾
RegisterView(showRegister: $showRegister)
            // â†‘ $ ç¬¦å·åˆ›å»º Bindingï¼ˆç»‘å®šï¼‰
```

```swift
// å­è§†å›¾ RegisterView
@Binding var showRegister: Bool  // æ¥æ”¶æ¥è‡ªçˆ¶è§†å›¾çš„ç»‘å®š

// åœ¨å­è§†å›¾ä¸­ä¿®æ”¹
showRegister = false  // ç›´æ¥ä¿®æ”¹ä¼šåŒæ­¥åˆ°çˆ¶è§†å›¾
```

**å…³é”®æ¦‚å¿µ**:
- **`@State`**: è§†å›¾è‡ªå·±æ‹¥æœ‰çš„çŠ¶æ€
- **`@Binding`**: å¯¹çˆ¶è§†å›¾çŠ¶æ€çš„å¼•ç”¨ï¼Œå¯ä»¥åŒå‘åŒæ­¥
- **`$` ç¬¦å·**: åˆ›å»º Binding çš„è¯­æ³•ç³–

---

### æ³¨å†Œæµç¨‹å›¾

```mermaid
graph TD
    A[ç”¨æˆ·åœ¨ç™»å½•ç•Œé¢ç‚¹å‡»æ³¨å†Œ] --> B[LoginView: showRegister = true]
    B --> C[SwiftUI æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–]
    C --> D["é‡æ–°è¯„ä¼° body: if showRegister"]
    D --> E[æ¸²æŸ“ RegisterView]
    
    E --> F[ç”¨æˆ·å¡«å†™æ³¨å†Œä¿¡æ¯]
    F --> G[ç‚¹å‡»æ³¨å†ŒæŒ‰é’®]
    G --> H[handleRegister éªŒè¯è¾“å…¥]
    H --> I{éªŒè¯ç»“æœ}
    
    I -->|å¤±è´¥| J[æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
    
    I -->|æˆåŠŸ| K[è°ƒç”¨ performRegister]
    K --> L[æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚]
    L --> M{æ³¨å†ŒæˆåŠŸ?}
    
    M -->|æ˜¯| N["RegisterView: showRegister = false"]
    N --> O[çŠ¶æ€åŒæ­¥åˆ° LoginView]
    O --> P[SwiftUI é‡æ–°æ¸²æŸ“]
    P --> Q[æ˜¾ç¤ºç™»å½•ç•Œé¢]
    
    M -->|å¦| R[æ˜¾ç¤ºæ³¨å†Œå¤±è´¥é”™è¯¯]
```

---

### å¯†ç ä¸€è‡´æ€§æ£€æŸ¥é€»è¾‘

```swift
// éªŒè¯ä¸¤æ¬¡å¯†ç æ˜¯å¦ä¸€è‡´
guard password == confirmPassword else {
    errorMessage = "ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´"
    return  // ä¸­æ–­æ³¨å†Œæµç¨‹
}
```

**æ‰§è¡Œæ—¶æœº**: åœ¨ç‚¹å‡»æ³¨å†ŒæŒ‰é’®åï¼ŒéªŒè¯ç”¨æˆ·åå’Œå¯†ç æ ¼å¼ä¹‹å

---

## ğŸ”„ çŠ¶æ€ç®¡ç†è¯¦è§£

### SwiftUI å“åº”å¼æ›´æ–°æœºåˆ¶

```mermaid
graph LR
    A[ç”¨æˆ·æ“ä½œ] --> B[ä¿®æ”¹ @State å˜é‡]
    B --> C[SwiftUI æ ‡è®°è§†å›¾ä¸ºè„]
    C --> D[é‡æ–°è®¡ç®— body]
    D --> E[å¯¹æ¯”æ–°æ—§è§†å›¾æ ‘]
    E --> F[åªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†]
    F --> G[æ¸²æŸ“åˆ°å±å¹•]
```

### ç¤ºä¾‹ï¼šé”™è¯¯ä¿¡æ¯æ˜¾ç¤º

```swift
// åœ¨ LoginView ä¸­
@State private var errorMessage: String = ""

// UI éƒ¨åˆ†
if !errorMessage.isEmpty {
    Text(errorMessage)
        .foregroundColor(.red)
}

// å½“è®¾ç½®é”™è¯¯ä¿¡æ¯æ—¶
errorMessage = "è¯·è¾“å…¥å¯†ç "
// â†“ SwiftUI è‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
// 1. æ£€æµ‹åˆ° errorMessage å˜åŒ–
// 2. é‡æ–°è¯„ä¼° if !errorMessage.isEmpty â†’ å˜ä¸º true
// 3. æ¸²æŸ“ Text è§†å›¾
// 4. æ›´æ–°å±å¹•æ˜¾ç¤º
```

---

## ğŸ“Š æ•°æ®æµå‘å›¾

### å®Œæ•´çš„ç™»å½•æµç¨‹æ•°æ®æµ

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant UI as LoginView UI
    participant State as @State å˜é‡
    participant Handler as handleLogin()
    participant Validator as InputValidator
    participant API as performLogin (ä¼ªä»£ç )
    
    U->>UI: è¾“å…¥ç”¨æˆ·å "test@example.com"
    UI->>State: username = "test@example.com"
    State-->>UI: è§¦å‘é‡æ–°æ¸²æŸ“
    
    U->>UI: è¾“å…¥å¯†ç  "123456"
    UI->>State: password = "123456"
    State-->>UI: è§¦å‘é‡æ–°æ¸²æŸ“
    
    U->>UI: ç‚¹å‡»ç™»å½•æŒ‰é’®
    UI->>Handler: è°ƒç”¨ handleLogin()
    
    Handler->>State: errorMessage = ""
    State-->>UI: éšè—é”™è¯¯æç¤º
    
    Handler->>Validator: isValidUsername("test@example.com")
    Validator-->>Handler: true âœ…
    
    Handler->>Validator: isValidPassword("123456")
    Validator-->>Handler: true âœ…
    
    Handler->>State: isLoading = true
    State-->>UI: æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
    
    Handler->>API: performLogin(username, password)
    
    Note over API: æ¨¡æ‹Ÿå»¶è¿Ÿ 1.5 ç§’
    
    API-->>Handler: è¿”å› true (ç™»å½•æˆåŠŸ)
    
    Handler->>State: isLoading = false
    State-->>UI: éšè—åŠ è½½åŠ¨ç”»
    
    Handler->>Handler: print("âœ… ç™»å½•æˆåŠŸ")
```

---

## ğŸ”§ å…³é”®æŠ€æœ¯ç‚¹è§£æ

### 1. `SecureField` çš„å·¥ä½œåŸç†

```swift
SecureField("è¯·è¾“å…¥å¯†ç ", text: $password)
```

- **ç»‘å®š**: `$password` å°†è¾“å…¥æ¡†ä¸ `password` å˜é‡åŒå‘ç»‘å®š
- **å®‰å…¨æ€§**: ç”¨æˆ·è¾“å…¥æ—¶è‡ªåŠ¨æ˜¾ç¤ºä¸ºåœ†ç‚¹ â—
- **æ•°æ®å­˜å‚¨**: å®é™…å€¼ä»¥æ˜æ–‡å­˜å‚¨åœ¨ `password` å˜é‡ä¸­ï¼ˆä»…æ˜¾ç¤ºæ—¶éšè—ï¼‰

**æ³¨æ„**: `SecureField` åªè´Ÿè´£æ˜¾ç¤ºæ—¶çš„éšè—ï¼ŒçœŸæ­£çš„å®‰å…¨éœ€è¦åœ¨ç½‘ç»œä¼ è¾“å’Œå­˜å‚¨æ—¶åŠ å¯†ã€‚

---

### 2. `onChange` ä¿®é¥°ç¬¦

```swift
TextField("æ‰‹æœºå·æˆ–é‚®ç®±", text: $username)
    .onChange(of: username) { _ in
        if !errorMessage.isEmpty {
            errorMessage = ""
        }
    }
```

**æ‰§è¡Œæ—¶æœº**: æ¯æ¬¡ `username` å˜é‡çš„å€¼æ”¹å˜æ—¶

**ç”¨é€”**: å®ç°"ç”¨æˆ·é‡æ–°è¾“å…¥æ—¶æ¸…é™¤é”™è¯¯ä¿¡æ¯"çš„äº¤äº’é€»è¾‘

---

### 3. `guard` è¯­å¥çš„æå‰é€€å‡ºæœºåˆ¶

```swift
guard InputValidator.isValidUsername(username) else {
    errorMessage = InputValidator.getUsernameErrorMessage(username)
    return  // æå‰é€€å‡ºå‡½æ•°
}
// åªæœ‰éªŒè¯é€šè¿‡æ‰ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
```

**ä¼˜åŠ¿**: 
- ä»£ç å¯è¯»æ€§å¼ºï¼ˆæ­£å‘é€»è¾‘ï¼‰
- é¿å…æ·±å±‚åµŒå¥—çš„ if-else

---

### 4. å¼‚æ­¥å»¶è¿Ÿæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚

```swift
DispatchQueue.main.asyncAfter(deadline: .now() + 1.5) {
    // 1.5 ç§’åæ‰§è¡Œè¿™é‡Œçš„ä»£ç 
    let success = performLogin(username: username, password: password)
    // ...
}
```

**ç”¨é€”**: æ¨¡æ‹ŸçœŸå®çš„ç½‘ç»œè¯·æ±‚å»¶è¿Ÿ

**æ³¨æ„**: `DispatchQueue.main` ç¡®ä¿å›è°ƒåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼ˆUI æ›´æ–°å¿…é¡»åœ¨ä¸»çº¿ç¨‹ï¼‰

---

## ğŸ¯ ä¼ªä»£ç ä¸çœŸå®ä»£ç çš„å¯¹æ¯”

### å½“å‰å®ç°ï¼ˆä¼ªä»£ç ï¼‰

```swift
private func performLogin(username: String, password: String) -> Bool {
    // ç¡¬ç¼–ç çš„æµ‹è¯•è´¦å·éªŒè¯
    return (username == "13800138000" || username == "test@example.com") 
           && password == "123456"
}
```

### çœŸå®å®ç°ï¼ˆç½‘ç»œè¯·æ±‚ï¼‰

```swift
private func performLogin(username: String, password: String) async throws -> Bool {
    // 1. æ„å»º API è¯·æ±‚
    let url = URL(string: "https://api.example.com/login")!
    var request = URLRequest(url: url)
    request.httpMethod = "POST"
    request.setValue("application/json", forHTTPHeaderField: "Content-Type")
    
    // 2. æ„å»ºè¯·æ±‚ä½“
    let body = ["username": username, "password": password]
    request.httpBody = try JSONEncoder().encode(body)
    
    // 3. å‘é€è¯·æ±‚
    let (data, response) = try await URLSession.shared.data(for: request)
    
    // 4. è§£æå“åº”
    let httpResponse = response as! HTTPURLResponse
    guard httpResponse.statusCode == 200 else {
        return false
    }
    
    // 5. è§£æ JSON å¹¶ä¿å­˜ Token
    let result = try JSONDecoder().decode(LoginResponse.self, from: data)
    saveToken(result.token)
    
    return true
}

struct LoginResponse: Codable {
    let token: String
    let user: User
}
```

---

## ğŸ§© è§†å›¾å±‚çº§ç»“æ„

```
chat_storageApp (åº”ç”¨æ ¹)
    â””â”€â”€ WindowGroup (çª—å£ç»„)
        â””â”€â”€ LoginView (@State showRegister = false)
            â”œâ”€â”€ loginContent (ç™»å½•ç•Œé¢å†…å®¹)
            â”‚   â”œâ”€â”€ VStack (å‚ç›´å¸ƒå±€)
            â”‚   â”‚   â”œâ”€â”€ Image (Logo)
            â”‚   â”‚   â”œâ”€â”€ Text (æ ‡é¢˜)
            â”‚   â”‚   â”œâ”€â”€ TextField (ç”¨æˆ·åè¾“å…¥æ¡†) [ç»‘å®šåˆ° username]
            â”‚   â”‚   â”œâ”€â”€ SecureField (å¯†ç è¾“å…¥æ¡†) [ç»‘å®šåˆ° password]
            â”‚   â”‚   â”œâ”€â”€ Text (é”™è¯¯æç¤º) [ç»‘å®šåˆ° errorMessage]
            â”‚   â”‚   â”œâ”€â”€ Button (ç™»å½•æŒ‰é’®) [action: handleLogin]
            â”‚   â”‚   â””â”€â”€ Button (æ³¨å†ŒæŒ‰é’®) [action: showRegister = true]
            â”‚
            â””â”€â”€ RegisterView (@Binding showRegister)
                â””â”€â”€ VStack (å‚ç›´å¸ƒå±€)
                    â”œâ”€â”€ Image (Logo)
                    â”œâ”€â”€ Text (æ ‡é¢˜)
                    â”œâ”€â”€ TextField (ç”¨æˆ·å) [ç»‘å®šåˆ°æœ¬åœ° username]
                    â”œâ”€â”€ SecureField (å¯†ç ) [ç»‘å®šåˆ°æœ¬åœ° password]
                    â”œâ”€â”€ SecureField (ç¡®è®¤å¯†ç ) [ç»‘å®šåˆ°æœ¬åœ° confirmPassword]
                    â”œâ”€â”€ Text (é”™è¯¯æç¤º)
                    â”œâ”€â”€ Button (æ³¨å†ŒæŒ‰é’®) [action: handleRegister]
                    â””â”€â”€ Button (è¿”å›ç™»å½•) [action: showRegister = false]
```

---

## ğŸ’¡ çŠ¶æ€åŒæ­¥çš„æ ¸å¿ƒåŸç†

### åœºæ™¯ï¼šä»æ³¨å†Œè¿”å›ç™»å½•

```swift
// 1ï¸âƒ£ åœ¨ LoginView ä¸­
@State private var showRegister: Bool = false

// 2ï¸âƒ£ ä¼ é€’ç»™ RegisterView
RegisterView(showRegister: $showRegister)

// 3ï¸âƒ£ åœ¨ RegisterView ä¸­æ¥æ”¶
@Binding var showRegister: Bool

// 4ï¸âƒ£ æ³¨å†ŒæˆåŠŸåï¼Œåœ¨ RegisterView ä¸­ä¿®æ”¹
showRegister = false

// 5ï¸âƒ£ æ•°æ®æµå‘ï¼š
RegisterView.showRegister (false) 
    â†’ è‡ªåŠ¨åŒæ­¥åˆ° â†’
LoginView.showRegister (false)
    â†’ è§¦å‘ LoginView é‡æ–°æ¸²æŸ“ â†’
if showRegister { ... } else { loginContent }
    â†’ æ˜¾ç¤º loginContent
```

**å…³é”®**: `@Binding` ä¸æ˜¯æ‹·è´ï¼Œè€Œæ˜¯å¼•ç”¨ï¼Œä¿®æ”¹ä¼šç«‹å³åæ˜ åˆ°æºå¤´ã€‚

---

## ğŸ“‹ æ‰§è¡Œæ—¶åºæ€»ç»“

### åº”ç”¨å¯åŠ¨åˆ°ç™»å½•æˆåŠŸçš„å®Œæ•´æ—¶åº

```
1. åº”ç”¨å¯åŠ¨
   â†“
2. chat_storageApp åˆå§‹åŒ–
   â†“
3. åˆ›å»º PersistenceController.shared
   â†“
4. åˆ›å»º WindowGroup
   â†“
5. åˆå§‹åŒ– LoginView
   â”œâ”€ username = ""
   â”œâ”€ password = ""
   â”œâ”€ errorMessage = ""
   â”œâ”€ showRegister = false
   â””â”€ isLoading = false
   â†“
6. æ¸²æŸ“ LoginView.body
   â”œâ”€ if showRegister â†’ false
   â””â”€ æ˜¾ç¤º loginContent
   â†“
7. ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
   â”œâ”€ TextField æ›´æ–° username
   â””â”€ SecureField æ›´æ–° password
   â†“
8. ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®
   â†“
9. è°ƒç”¨ handleLogin()
   â”œâ”€ errorMessage = ""
   â”œâ”€ InputValidator.isValidUsername(username) â†’ true
   â”œâ”€ InputValidator.isValidPassword(password) â†’ true
   â”œâ”€ isLoading = true (UI æ˜¾ç¤ºåŠ è½½åŠ¨ç”»)
   â”œâ”€ DispatchQueue.main.asyncAfter(1.5s)
   â”‚   â”œâ”€ performLogin() â†’ true
   â”‚   â”œâ”€ isLoading = false (UI éšè—åŠ è½½åŠ¨ç”»)
   â”‚   â””â”€ print("âœ… ç™»å½•æˆåŠŸ")
   â””â”€ ç­‰å¾… TODO: å¯¼èˆªåˆ°ä¸»ç•Œé¢
```

---

## ğŸš§ å½“å‰é™åˆ¶ä¸ä¸‹ä¸€æ­¥

### å½“å‰åŠŸèƒ½é™åˆ¶

1. **æ— çœŸå®ç½‘ç»œè¯·æ±‚** - ä½¿ç”¨ä¼ªä»£ç æ¨¡æ‹Ÿ
2. **æ— çŠ¶æ€æŒä¹…åŒ–** - é‡å¯åº”ç”¨ä¼šå›åˆ°ç™»å½•ç•Œé¢
3. **æ—  Token ç®¡ç†** - æ²¡æœ‰ä¿å­˜ç™»å½•å‡­è¯
4. **æ— ä¸»ç•Œé¢å¯¼èˆª** - ç™»å½•æˆåŠŸåæ— æ³•è·³è½¬
5. **å¯†ç æ˜æ–‡ä¼ è¾“** - å®é™…é¡¹ç›®éœ€è¦åŠ å¯†

### ä¸‹ä¸€æ­¥æ”¹è¿›æ–¹å‘

1. **é›†æˆç½‘ç»œå±‚** â†’ ä½¿ç”¨ URLSession è°ƒç”¨çœŸå® API
2. **æ·»åŠ çŠ¶æ€ç®¡ç†å™¨** â†’ åˆ›å»º AuthManager ç®¡ç†ç™»å½•çŠ¶æ€
3. **å®ç°è‡ªåŠ¨ç™»å½•** â†’ ä¿å­˜ Token åˆ° Keychain
4. **å®Œå–„ä¸»ç•Œé¢å¯¼èˆª** â†’ æ ¹æ®ç™»å½•çŠ¶æ€æ˜¾ç¤ºä¸åŒç•Œé¢
5. **æ·»åŠ é”™è¯¯å¤„ç†** â†’ ç½‘ç»œé”™è¯¯ã€è¶…æ—¶ã€æœåŠ¡å™¨é”™è¯¯ç­‰

---

**âœ… é€»è¾‘åˆ†æå®Œæˆï¼** å¸Œæœ›è¿™ä»½æ–‡æ¡£èƒ½å¸®åŠ©æ‚¨ç†è§£æ•´ä¸ªåŠŸèƒ½çš„è¿è¡Œæœºåˆ¶ã€‚
